// <ppj name="Moveta.Intern" date="1/17/2024 7:59:41 AM" id="F4EC85BAD2BF79AC25C9F8643540E90F9BE1DAF0"/>
// ======================================================================================================
// This code was generated by the Ice Porter(tm) Tool version 4.8.15.0
// Ice Porter is part of The Porting Project (PPJ) by Ice Tea Group, LLC.
// The generated code is not guaranteed to be accurate and to compile without
// manual modifications.
// 
// ICE TEA GROUP LLC SHALL IN NO EVENT BE LIABLE FOR ANY DAMAGES WHATSOEVER
// (INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF BUSINESS PROFITS, BUSINESS
// INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY OTHER LOSS OF ANY KIND)
// ARISING OUT OF THE USE OR INABILITY TO USE THE GENERATED CODE, WHETHER
// DIRECT, INDIRECT, INCIDENTAL, CONSEQUENTIAL, SPECIAL OR OTHERWISE, REGARDLESS
// OF THE FORM OF ACTION, EVEN IF ICE TEA GROUP LLC HAS BEEN ADVISED OF THE
// POSSIBILITY OF SUCH DAMAGES.
// =====================================================================================================
using System;
using System.Text;
using System.Drawing;
using System.Diagnostics;
using System.Collections;
using System.Windows.Forms;
using System.ComponentModel;
using MT;
using PPJ.Runtime;
using PPJ.Runtime.Com;
using PPJ.Runtime.Sql;
using PPJ.Runtime.Vis;
using PPJ.Runtime.Windows;
using PPJ.Runtime.Windows.QO;
using PPJ.Runtime.XSal;

namespace Moveta.Intern
{
	
	/// <summary>
	/// </summary>
	/// <param name="nPArzt"></param>
	/// <param name="nPHalter"></param>
	/// <param name="nPRech"></param>
	/// <param name="nPPR"></param>
	/// <param name="lsPText"></param>
	public partial class dlgZahlInfo : SalDialogBox
	{
		#region Window Parameters
		public SalNumber nPArzt;
		public SalNumber nPHalter;
		public SalNumber nPRech;
		public SalNumber nPPR;
		public SalString lsPText;
		#endregion
		
		#region Window Variables
		public SalString strKTi = "";
		public SalString strKVN = "";
		public SalString strKNN = "";
		public SalString strKN2 = "";
		public SalString strKS = "";
		public SalString strKO = "";
		public SalString strKL = "";
		public SalString strKuerzel = "";
		public SalString strZust = "";
		#endregion
		
		#region Constructors/Destructors
		
		/// <summary>
		/// Default Constructor.
		/// </summary>
		public dlgZahlInfo(SalNumber nPArzt, SalNumber nPHalter, SalNumber nPRech, SalNumber nPPR, SalString lsPText)
		{
			// Assign global reference.
			App.dlgZahlInfo = this;
			// Window Parameters initialization.
			this.nPArzt = nPArzt;
			this.nPHalter = nPHalter;
			this.nPRech = nPRech;
			this.nPPR = nPPR;
			this.lsPText = lsPText;
			// This call is required by the Windows Form Designer.
			InitializeComponent();
		}
		#endregion
		
		#region System Methods/Properties
		
		/// <summary>
		/// Shows the modal dialog.
		/// </summary>
		/// <param name="owner"></param>
		/// <returns></returns>
		public static SalNumber ModalDialog(Control owner, SalNumber nPArzt, SalNumber nPHalter, SalNumber nPRech, SalNumber nPPR, SalString lsPText)
		{
			dlgZahlInfo dlg = new dlgZahlInfo(nPArzt, nPHalter, nPRech, nPPR, lsPText);
			SalNumber ret = dlg.ShowDialog(owner);
			return ret;
		}
		
		/// <summary>
		/// Returns the object instance associated with the window handle.
		/// </summary>
		/// <param name="handle"></param>
		/// <returns></returns>
		[DebuggerStepThrough]
		public static dlgZahlInfo FromHandle(SalWindowHandle handle)
		{
			return ((dlgZahlInfo)SalWindow.FromHandle(handle, typeof(dlgZahlInfo)));
		}
		#endregion
		
		#region Window Actions
		
		/// <summary>
		/// dlgZahlInfo WindowActions Handler
		/// </summary>
		/// <param name="sender"></param>
		/// <param name="e"></param>
		private void dlgZahlInfo_WindowActions(object sender, WindowActionsEventArgs e)
		{
			#region Actions
			switch (e.ActionType)
			{
				case Sys.SAM_CreateComplete:
					this.dlgZahlInfo_OnSAM_CreateComplete(sender, e);
					break;
			}
			#endregion
		}
		
		/// <summary>
		/// SAM_CreateComplete event handler.
		/// </summary>
		/// <param name="sender"></param>
		/// <param name="e"></param>
		private void dlgZahlInfo_OnSAM_CreateComplete(object sender, WindowActionsEventArgs e)
		{
			#region Actions
			e.Handled = true;
			this.dfA.Number = this.nPArzt;
			this.dfH.Number = this.nPHalter;
			this.dfR.Number = this.nPRech;
			this.dfPR.Number = this.nPPR;
			this.mlNachricht.Text = this.lsPText;
			Int.SqlImmedSel(@"SELECT hti, hvn, hnn, hname2, hstr, hort, hland
INTO :dlgZahlInfo.strKTi, :dlgZahlInfo.strKVN, :dlgZahlInfo.strKNN, :dlgZahlInfo.strKN2, :dlgZahlInfo.strKS, :dlgZahlInfo.strKO, :dlgZahlInfo.strKL
FROM h WHERE harztnr = :dlgZahlInfo.dfA AND hhalternr = :dlgZahlInfo.dfH AND hdeaktiv IS NULL");
			this.mlKunde.Text = this.strKTi;
			if (this.strKVN != "") 
			{
				this.mlKunde.Text = this.mlKunde.Text + this.strKVN + " ";
			}
			this.mlKunde.Text = this.mlKunde.Text + this.strKNN;
			if (this.strKN2 != "") 
			{
				this.mlKunde.Text = this.mlKunde.Text + @"
" + this.strKN2;
			}
			if (this.strKS != "") 
			{
				this.mlKunde.Text = this.mlKunde.Text + @"
" + this.strKS;
			}
			if (this.strKO != "") 
			{
				this.mlKunde.Text = this.mlKunde.Text + @"
" + this.strKO;
			}
			if (this.strKL != "") 
			{
				this.mlKunde.Text = this.mlKunde.Text + @"
" + Int.PalGetLand(ref this.strKL);
			}
			// 02.02.11
			if (this.dfR.Number < 999990) 
			{
				Int.SqlImmedSel("SELECT MAX(prdnr) INTO :dlgZahlInfo.dfPR FROM prd WHERE prdarztnr = :dlgZahlInfo.dfA AND prdhalternr = :dlgZahlInfo.dfH AND prdrechnr = :dlgZahlInfo.dfR");
			}
			#endregion
		}
		
		/// <summary>
		/// pbOk WindowActions Handler
		/// </summary>
		/// <param name="sender"></param>
		/// <param name="e"></param>
		private void pbOk_WindowActions(object sender, WindowActionsEventArgs e)
		{
			#region Actions
			switch (e.ActionType)
			{
				case Sys.SAM_Click:
					this.pbOk_OnSAM_Click(sender, e);
					break;
			}
			#endregion
		}
		
		/// <summary>
		/// SAM_Click event handler.
		/// </summary>
		/// <param name="sender"></param>
		/// <param name="e"></param>
		private void pbOk_OnSAM_Click(object sender, WindowActionsEventArgs e)
		{
			#region Actions
			e.Handled = true;
			if (this.mlNachricht.Text == "") 
			{
				Sal.MessageBox("Bitte Textnachricht eingeben", "fehlende Eingabe", (Sys.MB_Ok | Sys.MB_IconExclamation));
			}
			else
			{
				this.strKuerzel = App.frmMain.strUser.Left(2);
				this.strZust = Int.PalZust(this.dfA.Number);
				// 13.05.14 F2027
				this.dfH.Number = Int.PalCheckNULL(this.dfH.Number);

				if (Sys.IDOK == Int.SqlImmed(@"
INSERT INTO Z (zvon, zan, zarztnr, zhalternr, zrechnr, zbemerk, zdatum, zwiedervor, zerledigt, zart, zzm, zzmdm, zproznr, zan0, zan1, zan2, zan3, zan4, zanzeige, zerfdat)
VALUES (:strBNZei, :dlgZahlInfo.strZust, :dlgZahlInfo.dfA, :dlgZahlInfo.dfH, :dlgZahlInfo.dfR,
:dlgZahlInfo.mlNachricht , SYSDATE, NULL, 'N', 'ZI', NULL, NULL, :dlgZahlInfo.dfPR, NULL, NULL, NULL, NULL, NULL,0, SYSDATETIME)")) 
				{
					Sal.MessageBeep(0);
					this.EndDialog(0);
				}
			}
			#endregion
		}
		
		/// <summary>
		/// pbAbbruch WindowActions Handler
		/// </summary>
		/// <param name="sender"></param>
		/// <param name="e"></param>
		private void pbAbbruch_WindowActions(object sender, WindowActionsEventArgs e)
		{
			#region Actions
			switch (e.ActionType)
			{
				case Sys.SAM_Click:
					this.pbAbbruch_OnSAM_Click(sender, e);
					break;
			}
			#endregion
		}
		
		/// <summary>
		/// SAM_Click event handler.
		/// </summary>
		/// <param name="sender"></param>
		/// <param name="e"></param>
		private void pbAbbruch_OnSAM_Click(object sender, WindowActionsEventArgs e)
		{
			#region Actions
			e.Handled = true;
			this.DestroyWindow();
			#endregion
		}
		#endregion
	}
}

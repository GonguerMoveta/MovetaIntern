// <ppj name="Moveta.Intern" date="1/17/2024 7:59:41 AM" id="F4EC85BAD2BF79AC25C9F8643540E90F9BE1DAF0"/>
// ======================================================================================================
// This code was generated by the Ice Porter(tm) Tool version 4.8.15.0
// Ice Porter is part of The Porting Project (PPJ) by Ice Tea Group, LLC.
// The generated code is not guaranteed to be accurate and to compile without
// manual modifications.
// 
// ICE TEA GROUP LLC SHALL IN NO EVENT BE LIABLE FOR ANY DAMAGES WHATSOEVER
// (INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF BUSINESS PROFITS, BUSINESS
// INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY OTHER LOSS OF ANY KIND)
// ARISING OUT OF THE USE OR INABILITY TO USE THE GENERATED CODE, WHETHER
// DIRECT, INDIRECT, INCIDENTAL, CONSEQUENTIAL, SPECIAL OR OTHERWISE, REGARDLESS
// OF THE FORM OF ACTION, EVEN IF ICE TEA GROUP LLC HAS BEEN ADVISED OF THE
// POSSIBILITY OF SUCH DAMAGES.
// =====================================================================================================
using System;
using System.Text;
using System.Drawing;
using System.Diagnostics;
using System.Collections;
using System.Windows.Forms;
using System.ComponentModel;
using MT;
using PPJ.Runtime;
using PPJ.Runtime.Com;
using PPJ.Runtime.Sql;
using PPJ.Runtime.Vis;
using PPJ.Runtime.Windows;
using PPJ.Runtime.Windows.QO;
using PPJ.Runtime.XSal;
using DYMO.Label.Framework;

namespace Moveta.Intern
{

    /// <summary>
    /// </summary>
    /// <param name="lsPAdresse"></param>
    /// <param name="strParent"></param>
    public partial class frmDYMODruck : SalFormWindow
    {
        #region Window Parameters
        public SalString lsPAdresse;
        public SalString strParent;
        #endregion

        #region Window Variables
        DYMO.Label.Framework.Label cDYMOLabel;
        public SalString strBCPrinters = "";
        public SalBoolean bBCExists = false;
        public SalBoolean bOk = false;
        public cBTRegistry oReg = new cBTRegistry();
        public SalString strDYMOLabel = "";
        public SalNumber nBarcodeNr = 0;
        #endregion

        #region Constructors/Destructors

        /// <summary>
        /// Default Constructor.
        /// </summary>
        public frmDYMODruck(SalString lsPAdresse, SalString strParent)
        {
            // Assign global reference.
            App.frmDYMODruck = this;
            // Window Parameters initialization.
            this.lsPAdresse = lsPAdresse;
            this.strParent = strParent;
            // This call is required by the Windows Form Designer.
            InitializeComponent();
        }
        #endregion

        #region System Methods/Properties

        /// <summary>
        /// Shows the form window.
        /// </summary>
        /// <param name="owner"></param>
        /// <returns></returns>
        public static frmDYMODruck CreateWindow(Control owner, SalString lsPAdresse, SalString strParent)
        {
            frmDYMODruck frm = new frmDYMODruck(lsPAdresse, strParent);
            frm.Show(owner);
            return frm;
        }

        /// <summary>
        /// Returns the object instance associated with the window handle.
        /// </summary>
        /// <param name="handle"></param>
        /// <returns></returns>
        [DebuggerStepThrough]
        public static frmDYMODruck FromHandle(SalWindowHandle handle)
        {
            return ((frmDYMODruck)SalWindow.FromHandle(handle, typeof(frmDYMODruck)));
        }
        #endregion

        #region Methods

        /// <summary>
        /// </summary>
        /// <returns></returns>
        public SalBoolean PalDruck()
        {
            #region Actions
            using (new SalContext(this))
            {
                if (cmbDYMOPrinters.Text != "")
                {
                    //FC:FINAL: DYMO Drucker
                    //cDYMOAddIn.SelectPrinter(cmbDYMOPrinters.Text, ref bBCExists);
                    string cDYMOPrinter = cmbDYMOPrinters.Text;
                    //if (!(bBCExists))
                    if (string.IsNullOrEmpty(cDYMOPrinter))
                    {
                        Sal.MessageBox(cmbDYMOPrinters.Text, "Fehler bei Druckerauswahl (SelectPrinter)", (Sys.MB_Ok | Sys.MB_IconExclamation));
                    }
                    else
                    {
                        try
                        {
                            // 29.11.16 Ä1450 .lwl -> .label
                            if (strParent == "frmManLE" || strParent.Left(5) == "Label")
                            {
                                //FC:FINAL: DYMO Drucker
                                //cDYMOAddIn.Open(Const.PATH_TVN32 + "Barcode (11354).label", ref bOk);
                                cDYMOLabel = (DYMO.Label.Framework.Label)DYMO.Label.Framework.Label.Open(Const.PATH_TVN32 + "Barcode (11354).label");
                            }
							// Else If SalStrLeftX( strParent, 5 ) = 'Label'
							// Call cDYMOAddIn.Open( Const.PATH_TVN32 + 'Barcode (11354)-NP.label', bOk )
							else
							{
                                if (cb11354.Checked)
                                {
									//FC:FINAL: DYMO Drucker
									//cDYMOAddIn.Open(Const.PATH_TVN32 + "Adresse (11354).label", ref bOk);
									cDYMOLabel = (DYMO.Label.Framework.Label)DYMO.Label.Framework.Label.Open(Const.PATH_TVN32 + "Barcode (11354).label");
                                }
                                else
                                {
									//FC:FINAL: DYMO Drucker
									//cDYMOAddIn.Open(Const.PATH_TVN32 + "Adresse (99010).label", ref bOk);
									cDYMOLabel = (DYMO.Label.Framework.Label)DYMO.Label.Framework.Label.Open(Const.PATH_TVN32 + "Adresse (11354).label");
                                }
                            }
                            bOk = true;
                        }
                        catch
                        {
                            bOk = false;
                        }
                        if (!(bOk))
                        {
                            // Call SalMessageBox( dfLabel, 'Labeldatei nicht gefunden:', MB_Ok|MB_IconExclamation)
                        }
                        else
                        {
                            // 28.01.08 A194
                            if (strParent == "frmManLE" || strParent.Left(5) == "Label")
                            {
                                //FC:FINAL: DYMO Drucker
                                //cDYMOLabels.SetField("BARCODE", mlAdresse.Text, ref bOk);
                                cDYMOLabel.SetObjectText("BARCODE", mlAdresse.Text);
                            }
                            else
                            {
                                //FC:FINAL: DYMO Drucker
                                //cDYMOLabels.SetField("Adresse", mlAdresse.Text, ref bOk);
                                cDYMOLabel.SetObjectText("Adresse", mlAdresse.Text);
                            }
                            // Call cDYMOLabels.SetField( 'KENNUNG', dfKennung, bOk )
                            //FC:FINAL: DYMO Drucker
                            //cDYMOAddIn.Print(dfAnzahl.Number, true, ref bOk);
                            cDYMOLabel.Print(cDYMOPrinter);
                            // If Not bOk
                            // Call SalMessageBox( dfLabel, 'Druck nicht erfolgreich', MB_Ok|MB_IconExclamation)
                        }
                    }
                    return true;
                }
                else
                {
                    return false;
                }
            }
            #endregion
        }

        /// <summary>
        /// </summary>
        /// <returns></returns>
        public SalNumber PalBarcode()
        {
            #region Actions
            using (new SalContext(this))
            {
                // 11.12.20
                Sal.HideWindowAndLabel(dfAnzahl);
                Sal.HideWindow(cb11354);
                nBarcodeNr = Int.PalGetProfileInt("Label", strParent.Mid(5, strParent.Length - 5), 0);
                nBarcodeNr = nBarcodeNr + 1;
                if (strParent.Mid(5, strParent.Length - 5) == "ED")
                {
                    mlAdresse.Text = Var.strBNAbtlg + Var.strBNZei + "50" + Int.PalStrNum0(nBarcodeNr, 8, 0);
                }
                else if (strParent.Mid(5, strParent.Length - 5) == "HP")
                {
                    mlAdresse.Text = Var.strBNAbtlg + Var.strBNZei + "31" + Int.PalStrNum0(nBarcodeNr, 8, 0);
                }
                else if (strParent.Mid(5, strParent.Length - 5) == "RA")
                {
                    mlAdresse.Text = Var.strBNAbtlg + Var.strBNZei + "30" + Int.PalStrNum0(nBarcodeNr, 8, 0);
                }
                else if (strParent.Mid(5, strParent.Length - 5) == "BH")  // 19.03.21
                {
                    mlAdresse.Text = Var.strBNAbtlg + Var.strBNZei + "31" + Int.PalStrNum0(nBarcodeNr, 8, 0);
                }
                else if (strParent.Mid(5, strParent.Length - 5) == "GF")  // 19.03.21
                {
                    mlAdresse.Text = Var.strBNAbtlg + Var.strBNZei + "10" + Int.PalStrNum0(nBarcodeNr, 8, 0);
                }
                // Set mlAdresse = '50' || PalStrNum0( 1880, 8, 0)
                Int.PalSetProfileString("Label", strParent.Mid(5, strParent.Length - 5), nBarcodeNr.ToString(0));
            }

            return 0;
            #endregion
        }
        #endregion

        #region Window Actions

        /// <summary>
        /// frmDYMODruck WindowActions Handler
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void frmDYMODruck_WindowActions(object sender, WindowActionsEventArgs e)
        {
            #region Actions
            switch (e.ActionType)
            {
                case Sys.SAM_CreateComplete:
                    this.frmDYMODruck_OnSAM_CreateComplete(sender, e);
                    break;

                case Sys.SAM_Create:
                    this.frmDYMODruck_OnSAM_Create(sender, e);
                    break;

                case Sys.SAM_Destroy:
                    this.frmDYMODruck_OnSAM_Destroy(sender, e);
                    break;
            }
            #endregion
        }

        /// <summary>
        /// SAM_CreateComplete event handler.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void frmDYMODruck_OnSAM_CreateComplete(object sender, WindowActionsEventArgs e)
        {
            #region Actions
            e.Handled = true;
            // Call SalMessageBox( '', 'CreateComplete', MB_Ok )
            Var.bfrmDYMODruck = true;

            this.mlAdresse.Text = this.lsPAdresse;
            // If cDYMOAddIn.Init(  )
            // Call SalStatusSetText(hWndForm, 'AddIn Created')
            // If cDYMOLabels.Init(  )
            // Call SalStatusSetText(hWndForm, 'Labels Created')
            //if (this.cDYMOAddIn.Init()) 
            //{
            //	this.SetStatusBarText("AddIn Created");
            //}
            //if (this.cDYMOLabels.Init()) 
            //{
            //	this.SetStatusBarText("Labels Created");
            //}

            // Call cDYMOAddIn.GetDymoPrinters( strBCPrinters )
            //FC:FINAL:#52 DYMO Drucker
            //this.cDYMOAddIn.GetDymoPrinters(ref this.strBCPrinters);
            var printers = DYMO.Label.Framework.Framework.GetLabelWriterPrinters();
            // Call SalMessageBox( '.' || strBCPrinters || '.', 'Dymo Drucker', MB_Ok )
            // Set strBCPrinters = 'DYMO LabelWriter 400 Turbo-USB|DYMO LabelWriter 330-USB'
            //while (this.strBCPrinters.Scan("|") != -1)
            //{
            //    this.cmbDYMOPrinters.AddListItem(this.strBCPrinters.Left(this.strBCPrinters.Scan("|")));
            //    if (this.cmbDYMOPrinters.Text == "" && this.strBCPrinters.Left(2) != "\\\\")
            //    {
            //        this.cmbDYMOPrinters.Text = this.strBCPrinters.Left(this.strBCPrinters.Scan("|"));
            //    }
            //    this.strBCPrinters = this.strBCPrinters.Mid(this.strBCPrinters.Scan("|") + 1, 32767);
            //}
            foreach (var printer in printers)
            {
                this.cmbDYMOPrinters.AddListItem(printer.Name);
                if (this.cmbDYMOPrinters.Text == "")
                {
                    this.cmbDYMOPrinters.Text = printer.Name;
                }
            }
            if (this.cmbDYMOPrinters.Text != "")
            {
                //FC:FINAL:#52 DYMO Drucker
                //this.cmbDYMOPrinters.AddListItem(this.strBCPrinters);
                //if (this.cmbDYMOPrinters.Text == "")
                //{
                //    this.cmbDYMOPrinters.Text = this.strBCPrinters;
                //}

                this.dfAnzahl.Number = 1;
                // 25.06.08
                this.oReg.SetRootKey(Const.HKEY_LOCAL_MACHINE);
                this.oReg.OpenKey("\\Software\\TVN\\TVN", true);
                this.oReg.ReadString("DYMO-Label", ref this.strDYMOLabel);
                if (this.strDYMOLabel == "99010")
                {
                    this.cb11354.Checked = false;
                }
                else
                {
                    this.cb11354.Checked = true;
                }
                // 20.02.15 Ä1169
                if (this.strParent.Left(5) == "Label")
                {
                    // Call SalHideWindowAndLabel( dfAnzahl )
                    // Call SalHideWindow( cb11354 )
                    // Set nBarcodeNr = PalGetProfileInt( 'Label', SalStrMidX( strParent, 5, SalStrLength( strParent ) - 5 ), 0 )
                    // Set nBarcodeNr = nBarcodeNr + 1
                    // If SalStrMidX( strParent, 5, SalStrLength( strParent ) - 5 ) = 'ED'
                    // Set mlAdresse = strBNAbtlg || strBNZei || '50' || PalStrNum0( nBarcodeNr, 8, 0)
                    // Else If SalStrMidX( strParent, 5, SalStrLength( strParent ) - 5 ) = 'HP'
                    // Set mlAdresse = strBNAbtlg || strBNZei || '31' || PalStrNum0( nBarcodeNr, 8, 0)
                    // Else If SalStrMidX( strParent, 5, SalStrLength( strParent ) - 5 ) = 'RA'
                    // Set mlAdresse = strBNAbtlg || strBNZei || '30' || PalStrNum0( nBarcodeNr, 8, 0)
                    // Set mlAdresse = '50' || PalStrNum0( 1880, 8, 0)
                    // Call PalSetProfileString( 'Label', SalStrMidX( strParent, 5, SalStrLength( strParent ) - 5 ), SalNumberToStrX( nBarcodeNr, 0 ))
                    this.PalBarcode();
                }
                // 08.11.07	28.01.08 A194 +  or strParent = 'frmManLE'
                if (this.strParent == "frmEDA" || this.strParent == "frmManLE" || this.strParent.Left(5) == "Label")
                {
                    if (this.PalDruck())
                    {
                        this.DestroyWindow();
                    }
                }
            }
            else
            {
                if (this.strParent == "frmManLE" || this.strParent.Left(5) == "Label")
                {
                    if (this.strParent.Left(5) == "Label")
                    {
                        this.PalBarcode();
                    }
                    dlgLlDruck.ModalDialog(App.frmMain, "DYMO-AlternativeBarcode.crd", this.mlAdresse.Text);
                }
                else
                {
                    dlgLlDruck.ModalDialog(App.frmMain, "DYMO-Alternative.crd", this.mlAdresse.Text);
                }
            }
            // Set dfLabel = 'C:\\Dokumente und Einstellungen\\All Users\\Dokumente\\DYMO Label\\Label Files\\Barcode - 89  x 36mm (99012).lwl'
            #endregion
        }

        /// <summary>
        /// SAM_Create event handler.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void frmDYMODruck_OnSAM_Create(object sender, WindowActionsEventArgs e)
        {
            #region Actions
            e.Handled = true;
            // Call SalMessageBox( '', 'Create', MB_Ok )
            #endregion
        }

        /// <summary>
        /// SAM_Destroy event handler.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void frmDYMODruck_OnSAM_Destroy(object sender, WindowActionsEventArgs e)
        {
            #region Actions
            e.Handled = true;
            // Call cDYMOAddIn.Release(  )
            // Call cDYMOLabels.Release(  )

            Var.bfrmDYMODruck = false;
            // 25.06.08
            this.oReg.SetRootKey(Const.HKEY_LOCAL_MACHINE);
            this.oReg.OpenKey("\\Software\\TVN\\TVN", true);
            if (this.cb11354.Checked)
            {
                this.oReg.WriteString("DYMO-Label", "11354");
            }
            else
            {
                this.oReg.WriteString("DYMO-Label", "99010");
            }
            #endregion
        }

        /// <summary>
        /// pbDruck WindowActions Handler
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void pbDruck_WindowActions(object sender, WindowActionsEventArgs e)
        {
            #region Actions
            switch (e.ActionType)
            {
                case Sys.SAM_Click:
                    this.pbDruck_OnSAM_Click(sender, e);
                    break;
            }
            #endregion
        }

        /// <summary>
        /// SAM_Click event handler.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void pbDruck_OnSAM_Click(object sender, WindowActionsEventArgs e)
        {
            #region Actions
            e.Handled = true;
            if (this.PalDruck())
            {
                if (this.strParent == "frmEDA" || this.strParent == "frmManLE")
                {
                    this.DestroyWindow();
                }
            }
            #endregion
        }

        /// <summary>
        /// pbDruck2 WindowActions Handler
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void pbDruck2_WindowActions(object sender, WindowActionsEventArgs e)
        {
            #region Actions
            switch (e.ActionType)
            {
                case Sys.SAM_Click:
                    this.pbDruck2_OnSAM_Click(sender, e);
                    break;
            }
            #endregion
        }

        /// <summary>
        /// SAM_Click event handler.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void pbDruck2_OnSAM_Click(object sender, WindowActionsEventArgs e)
        {
            #region Actions
            e.Handled = true;
            if (this.strParent == "frmManLE" || this.strParent.Left(5) == "Label")
            {
                dlgLlDruck.ModalDialog(App.frmMain, "DYMO-AlternativeBarcode.crd", this.mlAdresse.Text);
            }
            else
            {
                dlgLlDruck.ModalDialog(App.frmMain, "DYMO-Alternative.crd", this.mlAdresse.Text);
            }
            #endregion
        }

        /// <summary>
        /// pbAbbruch WindowActions Handler
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void pbAbbruch_WindowActions(object sender, WindowActionsEventArgs e)
        {
            #region Actions
            switch (e.ActionType)
            {
                case Sys.SAM_Click:
                    this.pbAbbruch_OnSAM_Click(sender, e);
                    break;
            }
            #endregion
        }

        /// <summary>
        /// SAM_Click event handler.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void pbAbbruch_OnSAM_Click(object sender, WindowActionsEventArgs e)
        {
            #region Actions
            e.Handled = true;
            this.DestroyWindow();
            #endregion
        }
        #endregion
    }
}
